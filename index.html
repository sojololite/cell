<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Sojolo Cell - Servicio de transferencia de saldo m√≥vil en Cuba. Recarga tu tel√©fono de forma r√°pida y segura.">
  <meta name="keywords" content="saldo m√≥vil, Cuba, transferencia, recarga, ETECSA, recargar celular, saldo Cuba">
  <meta name="msvalidate.01" content="27409BC667954ADA2020F71107F19DB2" />
  <title>Sojolo Cell - Saldo M√≥vil en Cuba</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%2325D366'/><text x='50%' y='50%' font-size='60' text-anchor='middle' alignment-baseline='middle' fill='white' font-family='Arial, sans-serif'>SC</text></svg>">
  <style>
    :root {
      --primary: #25D366;
      --primary-dark: #1a9c4d;
      --primary-light: #e8f7ed;
      --secondary: #667ee0;
      --secondary-dark: #5a6fd0;
      --light: #f8fafc;
      --white: #ffffff;
      --text: #2d3748;
      --text-dark: #1a202c;
      --muted: #718096;
      --border: #e2e8f0;
      --success: #38a169;
      --success-bg: #f0fff4;
      --warning: #d69e2e;
      --warning-bg: #fffaf0;
      --error: #e53e3e;
      --error-bg: #fff5f5;
      --overlay: rgba(0, 0, 0, 0.7);
      --radius: 12px;
      --radius-sm: 8px;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
      color: var(--text);
      line-height: 1.5;
      padding: 16px;
      max-width: 600px;
      margin: 0 auto;
      min-height: 100vh;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 16px 0 24px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .logo-text {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .header-btns {
      display: flex;
      gap: 8px;
    }

    .btn-sm, .btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-sm:hover, .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .btn-sm {
      padding: 8px 14px;
      font-size: 0.85rem;
    }

    .btn {
      width: 100%;
      padding: 16px;
      font-size: 1.05rem;
      margin-top: 10px;
      box-shadow: var(--shadow);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: var(--secondary);
    }

    .btn-secondary:hover {
      background: var(--secondary-dark);
    }

    .progress-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: 24px;
      position: relative;
    }

    .progress-indicator::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--border);
      transform: translateY(-50%);
      z-index: 0;
    }

    .progress-step {
      background: var(--white);
      padding: 8px 12px;
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      font-weight: 600;
      position: relative;
      z-index: 1;
      border: 2px solid var(--border);
      color: var(--muted);
      transition: all 0.3s ease;
    }

    .progress-step.active {
      border-color: var(--primary);
      color: var(--primary);
      background: var(--primary-light);
    }

    .section {
      background: var(--white);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      transition: all 0.3s ease;
    }

    .section-title {
      font-size: 1.2rem;
      margin-bottom: 16px;
      font-weight: 600;
      color: var(--text-dark);
    }

    .login-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
    }

    .input-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-dark);
    }

    .login-form input {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .login-form input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1);
    }

    .input-help {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .captcha-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: #f8f9fa;
      padding: 15px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
    }

    .captcha-display {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 10px;
      background: white;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      font-family: 'Courier New', monospace;
      font-size: 1.4rem;
      font-weight: bold;
      letter-spacing: 3px;
      color: var(--text-dark);
      user-select: none;
    }

    .captcha-controls {
      display: flex;
      gap: 10px;
    }

    .captcha-controls button {
      flex: 1;
      padding: 8px;
      background: var(--secondary);
      color: white;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s ease;
    }

    .captcha-controls button:hover {
      background: var(--secondary-dark);
    }

    .captcha-input {
      width: 100%;
      padding: 10px;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 1rem;
      text-align: center;
      letter-spacing: 2px;
      font-family: 'Courier New', monospace;
    }

    .captcha-input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1);
    }

    .options-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .option {
      padding: 14px;
      background: #fafafa;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 70px;
      transition: all 0.2s ease;
    }

    .option:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .option.selected {
      background: var(--success-bg);
      border-color: var(--primary);
      position: relative;
    }

    .option.selected::after {
      content: "‚úì";
      position: absolute;
      top: 8px;
      right: 8px;
      color: var(--success);
      font-weight: bold;
      font-size: 1rem;
    }

    .option.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .option-subtitle {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .custom-input {
      margin-top: 12px;
      display: none;
    }

    .custom-input input {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .custom-input input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1);
    }

    .provider-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 300px;
      overflow-y: auto;
    }

    .provider-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px;
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }

    .provider-item:hover {
      background: var(--primary-light);
    }

    .provider-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .provider-name {
      font-weight: 600;
    }

    .status {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 12px;
      font-weight: 600;
      width: fit-content;
    }

    .available {
      background: var(--success-bg);
      color: var(--success);
    }

    .unavailable {
      background: var(--error-bg);
      color: var(--error);
    }

    .info,
    .modal-info {
      font-size: 0.85rem;
      color: var(--muted);
      line-height: 1.5;
      margin-bottom: 12px;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 14px 20px;
      border-radius: var(--radius);
      color: white;
      font-weight: 600;
      z-index: 1001;
      box-shadow: var(--shadow-lg);
      transform: translateX(150%);
      max-width: 300px;
      transition: transform 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: var(--success);
    }

    .notification.error {
      background: var(--error);
    }

    .notification.warning {
      background: var(--warning);
    }

    .notification.info {
      background: var(--secondary);
    }

    .notification-icon {
      font-size: 1.2rem;
    }

    .promotion-banner {
      background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
      color: white;
      padding: 16px;
      border-radius: var(--radius);
      margin-top: 20px;
      display: none;
      justify-content: space-between;
      align-items: center;
      position: relative;
      box-shadow: var(--shadow);
    }

    .promotion-banner.show {
      display: flex;
    }

    .promotion-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
      background: var(--primary);
      border-radius: var(--radius-sm);
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
      margin-right: 12px;
    }

    .promotion-content h3 {
      margin-bottom: 6px;
      font-size: 1.1rem;
    }

    .promotion-content p {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    .promotion-btn {
      background: white;
      color: var(--secondary);
      padding: 8px 16px;
      border-radius: var(--radius-sm);
      font-weight: 600;
      text-decoration: none;
      display: inline-block;
      transition: all 0.2s ease;
    }

    .promotion-btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    .promotion-close {
      background: transparent;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      padding: 4px;
      align-self: flex-start;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--overlay);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      padding: 16px;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: white;
      border-radius: var(--radius);
      width: 100%;
      max-width: 400px;
      padding: 24px;
      box-shadow: var(--shadow-lg);
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }

    .modal-overlay.active .modal {
      transform: translateY(0);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--muted);
      padding: 4px;
      transition: color 0.2s ease;
    }

    .close-modal:hover {
      color: var(--text);
    }

    .price-list {
      list-style: none;
    }

    .price-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
    }

    .price-item:last-child {
      border-bottom: none;
    }

    .price-value {
      color: var(--primary);
      font-weight: 600;
    }

    .contact-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: center;
    }

    .contact-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: var(--primary-light);
      color: var(--primary-dark);
      border: 1px solid var(--primary);
      border-radius: var(--radius-sm);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .contact-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-1px);
    }

    .client-info {
      background: var(--primary-light);
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      margin-bottom: 16px;
      border-left: 4px solid var(--primary);
    }

    .client-info p {
      margin: 4px 0;
      font-size: 0.9rem;
    }

    .client-info strong {
      color: var(--primary-dark);
    }

    @media (max-width: 480px) {
      body {
        padding: 12px;
      }
      .section {
        padding: 16px;
      }
      .logo-text {
        font-size: 1.2rem;
      }
      .btn-sm {
        padding: 6px 12px;
        font-size: 0.8rem;
      }
      .options-grid {
        grid-template-columns: 1fr;
      }
      .progress-step {
        font-size: 0.7rem;
        padding: 6px 8px;
      }
      .promotion-banner {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      .promotion-close {
        position: absolute;
        top: 10px;
        right: 10px;
      }
      .contact-buttons {
        flex-direction: column;
      }
      .captcha-controls {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div id="notification" class="notification" aria-live="polite">
    <span class="notification-icon"></span>
    <span class="notification-text"></span>
  </div>
  
  <header>
    <div class="logo">
      <div class="logo-icon">SC</div>
      <div class="logo-text">Sojolo Cell</div>
    </div>
    <div class="header-btns">
      <button class="btn-sm" id="openPricesBtn">üìä</button>
      <button class="btn-sm" id="downloadAppBtn">üì•</button>
      <button class="btn-sm" id="openPrivacyBtn">üîí</button>
    </div>
  </header>

  <main>
    <section class="section" id="loginSection">
      <h2 class="section-title">üîê Iniciar Sesi√≥n</h2>
      <div class="login-form">
        <div class="input-group">
          <label for="clientName" class="input-label">Nombre completo</label>
          <input type="text" id="clientName" placeholder="Ej: Juan P√©rez Garc√≠a" autocomplete="name" />
        </div>
        <div class="input-group">
          <label for="clientPhone" class="input-label">Tu n√∫mero de m√≥vil</label>
          <input type="tel" id="clientPhone" placeholder="Ej: +53 5XXXXXXX" autocomplete="tel" inputmode="tel" />
          <p id="phoneHelp" class="input-help">Formato: +53 seguido de 8 d√≠gitos</p>
        </div>
        
        <div class="captcha-container">
          <div class="captcha-display" id="captchaDisplay">
            <span id="captchaText"></span>
            <button type="button" id="refreshCaptcha" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">üîÑ</button>
          </div>
          <div class="captcha-controls">
            <button type="button" id="newCaptcha">üîÑ Nuevo</button>
          </div>
          <input type="text" id="captchaInput" class="captcha-input" placeholder="Ingresa el c√≥digo" maxlength="6" />
        </div>
        
        <button class="btn" id="loginBtn">Iniciar Sesi√≥n</button>
      </div>
    </section>

    <div class="progress-indicator" id="progressIndicator">
      <div class="progress-step active" data-step="1">Login</div>
      <div class="progress-step" data-step="2">Cantidad</div>
      <div class="progress-step" data-step="3">Proveedor</div>
      <div class="progress-step" data-step="4">Confirmar</div>
    </div>

    <div class="client-info" id="clientInfo" style="display: none;">
      <p><strong>Cliente:</strong> <span id="displayClientName"></span></p>
      <p><strong>Tel√©fono:</strong> <span id="displayClientPhone"></span></p>
    </div>

    <section class="section" id="amountSection" style="display: none;">
      <h2 class="section-title">ü™ô Seleccione la cantidad</h2>
      <div class="options-grid">
        <div class="option" data-amount="120" role="button" tabindex="0">
          <span>120 CUP</span>
          <span class="option-subtitle">‚âà 675 CUP</span>
        </div>
        <div class="option" data-amount="240" role="button" tabindex="0">
          <span>240 CUP</span>
          <span class="option-subtitle">‚âà 1350 CUP</span>
        </div>
        <div class="option" data-amount="360" role="button" tabindex="0">
          <span>360 CUP</span>
          <span class="option-subtitle">‚âà 2025 CUP</span>
        </div>
        <div class="option" id="customOption" role="button" tabindex="0">
          <span>Otra cantidad</span>
        </div>
      </div>
      <div class="custom-input" id="customInputDiv">
        <input type="number" id="customAmountInput" placeholder="Ej: 100" min="1" inputmode="numeric" />
        <div id="customAmountResult" style="margin-top: 8px; font-size: 0.9rem; color: var(--primary); font-weight: 600; display: none;">
          Precio aproximado: <span id="customAmountPrice">0</span> CUP
        </div>
      </div>
    </section>

    <section class="section" id="providerSection" style="display: none;">
      <h2 class="section-title">üë§ Seleccione el proveedor</h2>
      <p class="info">‚ÑπÔ∏è El proveedor puede cambiar sin previo aviso.</p>
      <div class="provider-list">
        <div class="option provider-item" data-provider="+53 5 6584673" data-available="true" role="button" tabindex="0">
          <div class="provider-info">
            <span class="provider-name">Proveedor 1</span>
            <span class="status available">Disponible</span>
          </div>
        </div>
        <div class="option provider-item" data-provider="+53 5 0728907" data-available="true" role="button" tabindex="0">
          <div class="provider-info">
            <span class="provider-name">Proveedor 2</span>
            <span class="status available">Disponible</span>
          </div>
        </div>
        <div class="option provider-item" data-provider="+53 5 5384257" data-available="true" role="button" tabindex="0">
          <div class="provider-info">
            <span class="provider-name">Proveedor 3</span>
            <span class="status available">Disponible</span>
          </div>
        </div>
        <div class="option provider-item" data-provider="+53 63175552" data-available="true" role="button" tabindex="0">
          <div class="provider-info">
            <span class="provider-name">Proveedor 4</span>
            <span class="status available">Disponible</span>
          </div>
        </div>
      </div>
    </section>

    <button class="btn" id="whatsappBtn" style="display: none;">üí¨ Solicitar Transferencia</button>

    <div class="promotion-banner" id="promotionBanner">
      <div class="promotion-logo">SC</div>
      <div class="promotion-content">
        <h3>¬øNecesitas m√°s servicios?</h3>
        <p>Visita nuestra plataforma de negocios para m√°s opciones</p>
        <a href="https://sojololite.github.io/business/" class="promotion-btn" target="_blank" rel="noopener">Ver servicios</a>
      </div>
      <button class="promotion-close" id="closePromotion">&times;</button>
    </div>

    <div class="contact-buttons">
      <a href="mailto:sojololite@gmail.com?subject=Consulta%20Sojolo%20Cell" class="contact-btn">
        <span>‚úâÔ∏è</span> Gmail
      </a>
      <a href="https://www.facebook.com/profile.php?id=61583488733031" target="_blank" rel="noopener" class="contact-btn">
        <span>üìò</span> Facebook
      </a>
    </div>
  </main>

  <div class="modal-overlay" id="pricesModal" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modal-header">
        <h3>üìä Mercado Informal</h3>
        <button class="close-modal" id="closePricesModal">&times;</button>
      </div>
      <ul class="price-list">
        <li class="price-item">120 CUP <span class="price-value">= 675 CUP</span></li>
        <li class="price-item">240 CUP <span class="price-value">= 1350 CUP</span></li>
        <li class="price-item">360 CUP <span class="price-value">= 2025 CUP</span></li>
      </ul>
      <p class="modal-info">‚ÑπÔ∏è Precios orientativos del mercado informal. Pueden variar.</p>
    </div>
  </div>

  <div class="modal-overlay" id="privacyModal" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modal-header">
        <h3>üîí Pol√≠tica de Privacidad</h3>
        <button class="close-modal" id="closePrivacyModal">&times;</button>
      </div>
      <div class="modal-info">
        <p>Sojolo Cell es una plataforma de contacto entre usuarios y proveedores de saldo m√≥vil.</p>
        <p><strong>No almacenamos</strong> informaci√≥n personal de nadie.</p>
        <p><strong>No participamos</strong> en las transacciones ni nos hacemos responsables de los acuerdos entre usuarios y proveedores.</p>
        <p>El uso de esta plataforma es verificado y claro.</p>
      </div>
    </div>
  </div>

  <script>
    (function () {
      'use strict';

      const state = {
        clientName: '',
        clientPhone: '',
        amount: null,
        provider: null,
        step: 1,
        captchaCode: '',
        promotionShown: localStorage.getItem('promotionShown') !== 'true',
        notifications: [
          { message: "¬°Bienvenido a Sojolo Cell!", type: "info", icon: "üëã" },
          { message: "Recuerda verificar los precios antes de realizar tu pedido", type: "info", icon: "üí°" },
          { message: "Aseg√∫rate de que tu n√∫mero de tel√©fono sea correcto", type: "info", icon: "üì±" },
          { message: "Los proveedores pueden cambiar sin previo aviso", type: "info", icon: "‚ö†Ô∏è" }
        ],
        notificationInterval: null,
        autoSaveInterval: null
      };

      const el = {
        loginSection: document.getElementById('loginSection'),
        clientName: document.getElementById('clientName'),
        clientPhone: document.getElementById('clientPhone'),
        loginBtn: document.getElementById('loginBtn'),
        clientInfo: document.getElementById('clientInfo'),
        displayClientName: document.getElementById('displayClientName'),
        displayClientPhone: document.getElementById('displayClientPhone'),
        captchaDisplay: document.getElementById('captchaDisplay'),
        captchaText: document.getElementById('captchaText'),
        refreshCaptcha: document.getElementById('refreshCaptcha'),
        newCaptcha: document.getElementById('newCaptcha'),
        captchaInput: document.getElementById('captchaInput'),
        amountOpts: document.querySelectorAll('.option[data-amount]'),
        customOpt: document.getElementById('customOption'),
        customDiv: document.getElementById('customInputDiv'),
        customInp: document.getElementById('customAmountInput'),
        customAmountResult: document.getElementById('customAmountResult'),
        customAmountPrice: document.getElementById('customAmountPrice'),
        provSec: document.getElementById('providerSection'),
        provList: document.querySelector('.provider-list'),
        btn: document.getElementById('whatsappBtn'),
        openPrices: document.getElementById('openPricesBtn'),
        downloadApp: document.getElementById('downloadAppBtn'),
        openPrivacy: document.getElementById('openPrivacyBtn'),
        pricesModal: document.getElementById('pricesModal'),
        privacyModal: document.getElementById('privacyModal'),
        closePrices: document.getElementById('closePricesModal'),
        closePrivacy: document.getElementById('closePrivacyModal'),
        progressSteps: document.querySelectorAll('.progress-step'),
        notification: document.getElementById('notification'),
        notificationIcon: document.querySelector('.notification-icon'),
        notificationText: document.querySelector('.notification-text'),
        promotionBanner: document.getElementById('promotionBanner'),
        closePromotion: document.getElementById('closePromotion'),
        amountSection: document.getElementById('amountSection')
      };

      const calculatePriceWithMarkup = (basePrice) => {
        return Math.round(basePrice * 1.35);
      };

      const basePrices = {
        '120': 500,
        '240': 1000,
        '360': 1500
      };

      const utils = {
        sanitizePhone: (str) => str.replace(/[^\d+]/g, ''),
        
        validateCubanPhone: (phone) => {
          const cleanPhone = phone.replace(/\D/g, '');
          return /^(53)?5\d{7}$/.test(cleanPhone);
        },
        
        validateName: (name) => {
          return name.trim().length >= 3 && /^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/.test(name);
        },
        
        showNotification: (message, type = 'success', icon = '‚úì', duration = 4000) => {
          el.notificationIcon.textContent = icon;
          el.notificationText.textContent = message;
          el.notification.className = `notification ${type} show`;
          
          setTimeout(() => {
            el.notification.classList.remove('show');
          }, duration);
        },
        
        updateStep: (step) => {
          state.step = step;
          el.progressSteps.forEach((stepEl, index) => {
            if (index + 1 <= step) {
              stepEl.classList.add('active');
            } else {
              stepEl.classList.remove('active');
            }
          });
        },
        
        generateCaptcha: () => {
          const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
          let captcha = '';
          for (let i = 0; i < 6; i++) {
            captcha += chars.charAt(Math.floor(Math.random() * chars.length));
          }
          state.captchaCode = captcha;
          el.captchaText.textContent = captcha;
          el.captchaInput.value = '';
          return captcha;
        },
        
        validateCaptcha: () => {
          return el.captchaInput.value.toUpperCase() === state.captchaCode.toUpperCase();
        },

        calculateCustomPrice: (amount) => {
          if (!amount || isNaN(amount) || amount <= 0) return 0;
          
          let basePrice = 0;
          if (amount <= 120) {
            basePrice = 500;
          } else if (amount <= 240) {
            basePrice = 1000;
          } else if (amount <= 360) {
            basePrice = 1500;
          } else {
            basePrice = Math.round((amount / 360) * 1500);
          }
          
          return calculatePriceWithMarkup(basePrice);
        },
        
        autoSaveState: () => {
          try {
            const stateToSave = {
              clientName: state.clientName,
              clientPhone: state.clientPhone,
              amount: state.amount,
              provider: state.provider,
              step: state.step,
              lastSaved: new Date().toISOString()
            };
            localStorage.setItem('sojoloCellState', JSON.stringify(stateToSave));
          } catch (e) {
            console.warn('No se pudo guardar el estado autom√°ticamente:', e);
          }
        },
        
        loadSavedState: () => {
          try {
            const savedState = localStorage.getItem('sojoloCellState');
            if (savedState) {
              const parsed = JSON.parse(savedState);
              
              if (parsed.clientName && parsed.clientPhone) {
                state.clientName = parsed.clientName;
                state.clientPhone = parsed.clientPhone;
                el.clientName.value = parsed.clientName;
                el.clientPhone.value = parsed.clientPhone;
                
                el.loginSection.style.display = 'none';
                el.clientInfo.style.display = 'block';
                el.amountSection.style.display = 'block';
                el.btn.style.display = 'block';
                el.displayClientName.textContent = parsed.clientName;
                el.displayClientPhone.textContent = parsed.clientPhone;
                utils.updateStep(2);
                
                if (parsed.amount) {
                  state.amount = parsed.amount;
                  document.querySelectorAll('.option[data-amount]').forEach(opt => {
                    if (opt.dataset.amount === parsed.amount.split(' ')[0]) {
                      opt.classList.add('selected');
                    }
                  });
                }
                
                if (parsed.provider) {
                  state.provider = parsed.provider;
                  document.querySelectorAll('.provider-item').forEach(provider => {
                    if (provider.dataset.provider === parsed.provider) {
                      provider.classList.add('selected');
                      el.provSec.style.display = 'block';
                    }
                  });
                }
                
                utils.showNotification('Datos cargados autom√°ticamente', 'info', 'üîÑ', 3000);
              }
            }
          } catch (e) {
            console.warn('No se pudo cargar el estado guardado:', e);
          }
        },
        
        clearSavedState: () => {
          localStorage.removeItem('sojoloCellState');
        },

        showPromotion: () => {
          if (state.promotionShown) {
            el.promotionBanner.classList.add('show');
          }
        },

        hidePromotion: () => {
          el.promotionBanner.classList.remove('show');
          localStorage.setItem('promotionShown', 'true');
          state.promotionShown = false;
        },

        startRecurrentNotifications: () => {
          let notificationIndex = 0;
          
          setTimeout(() => {
            const notification = state.notifications[0];
            utils.showNotification(notification.message, notification.type, notification.icon, 5000);
            notificationIndex = 1;
          }, 5000);
          
          state.notificationInterval = setInterval(() => {
            if (notificationIndex < state.notifications.length) {
              const notification = state.notifications[notificationIndex];
              utils.showNotification(notification.message, notification.type, notification.icon, 5000);
              notificationIndex = (notificationIndex + 1) % state.notifications.length;
            }
          }, 30000);
        },

        stopRecurrentNotifications: () => {
          if (state.notificationInterval) {
            clearInterval(state.notificationInterval);
            state.notificationInterval = null;
          }
        },

        startAutoSave: () => {
          state.autoSaveInterval = setInterval(() => {
            utils.autoSaveState();
          }, 10000);
        },

        stopAutoSave: () => {
          if (state.autoSaveInterval) {
            clearInterval(state.autoSaveInterval);
            state.autoSaveInterval = null;
          }
        },

        checkNotificationPermission: () => {
          if ('Notification' in window) {
            if (Notification.permission === 'default') {
              Notification.requestPermission();
            }
          }
        },

        showSystemNotification: (title, body) => {
          if ('Notification' in window && Notification.permission === 'granted') {
            new Notification(title, { body, icon: '/favicon.ico' });
          }
        }
      };

      const handleLogin = () => {
        const name = el.clientName.value.trim();
        const phone = utils.sanitizePhone(el.clientPhone.value);
        
        if (!utils.validateName(name)) {
          utils.showNotification('Por favor, ingresa un nombre v√°lido (m√≠nimo 3 caracteres, solo letras)', 'error', '‚ùå');
          el.clientName.focus();
          return;
        }
        
        if (!utils.validateCubanPhone(phone)) {
          utils.showNotification('Formato de tel√©fono incorrecto. Ej: +53 51234567', 'error', '‚ùå', 3000);
          el.clientPhone.focus();
          return;
        }
        
        if (!utils.validateCaptcha()) {
          utils.showNotification('El c√≥digo de verificaci√≥n es incorrecto', 'error', '‚ùå');
          el.captchaInput.focus();
          utils.generateCaptcha();
          return;
        }
        
        state.clientName = name;
        state.clientPhone = phone;
        
        el.loginSection.style.display = 'none';
        el.clientInfo.style.display = 'block';
        el.amountSection.style.display = 'block';
        el.btn.style.display = 'block';
        el.displayClientName.textContent = name;
        el.displayClientPhone.textContent = phone;
        
        utils.updateStep(2);
        utils.showNotification('¬°Login exitoso! Tus datos se guardar√°n autom√°ticamente', 'success', '‚úÖ');
        utils.autoSaveState();
      };

      const selectProvider = (providerElement) => {
        if (providerElement.dataset.available !== 'true') return;
        
        document.querySelectorAll('.provider-item').forEach(item => {
          item.classList.remove('selected');
        });
        
        providerElement.classList.add('selected');
        
        state.provider = providerElement.dataset.provider;
        utils.updateStep(4);
        updateUI();
        utils.showNotification('Proveedor seleccionado', 'success', '‚úÖ');
        utils.autoSaveState();
      };

      const updateUI = () => {
        el.btn.disabled = !(state.amount && state.provider);
        
        if (state.amount && !state.provider) {
          utils.updateStep(2);
          el.provSec.style.display = 'block';
        } else if (state.amount && state.provider) {
          utils.updateStep(4);
        }
        
        utils.autoSaveState();

        if (state.amount && state.provider) {
          setTimeout(utils.showPromotion, 2000);
        }
      };

      const init = async () => {
        utils.loadSavedState();
        
        utils.generateCaptcha();
        
        utils.checkNotificationPermission();
        utils.startRecurrentNotifications();
        utils.startAutoSave();
        
        setTimeout(() => {
          if (Math.random() < 0.8 && state.clientName) {
            utils.showPromotion();
          }
        }, 8000);
        
        el.downloadApp.addEventListener('click', () => {
          window.open('https://github.com/sojololite/cell/raw/refs/heads/main/Sojolo%20Cell.apk', '_blank');
          utils.showNotification('Descargando aplicaci√≥n...', 'success', 'üì•');
        });

        el.refreshCaptcha.addEventListener('click', () => utils.generateCaptcha());
        el.newCaptcha.addEventListener('click', () => utils.generateCaptcha());

        el.loginBtn.addEventListener('click', handleLogin);

        el.clientName.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            handleLogin();
          }
        });

        el.clientPhone.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            handleLogin();
          }
        });

        el.captchaInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            handleLogin();
          }
        });

        el.amountOpts.forEach((opt) => {
          opt.addEventListener('click', () => {
            el.amountOpts.forEach((o) => o.classList.remove('selected'));
            opt.classList.add('selected');
            state.amount = `${opt.dataset.amount} CUP`;
            el.provSec.style.display = 'block';
            utils.updateStep(3);
            updateUI();
            utils.showNotification(`Cantidad seleccionada: ${state.amount}`, 'success', '‚úÖ');
            utils.autoSaveState();
          });
          
          opt.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              opt.click();
            }
          });
        });

        el.customOpt.addEventListener('click', () => {
          const isActive = el.customDiv.style.display === 'block';
          el.amountOpts.forEach((o) => o.classList.remove('selected'));
          el.customOpt.classList.toggle('selected', !isActive);
          el.customDiv.style.display = isActive ? 'none' : 'block';
          if (!isActive) el.customInp.focus();
          state.amount = isActive ? null : '';
          el.provSec.style.display = isActive ? 'none' : 'none';
          utils.updateStep(isActive ? 2 : 3);
          updateUI();
          utils.autoSaveState();
          
          if (!isActive) {
            utils.showNotification('Ingresa la cantidad deseada', 'info', 'üí°');
          }
        });

        el.customInp.addEventListener('input', () => {
          const val = el.customInp.value.trim();
          const amount = parseInt(val);
          
          if (val && !isNaN(amount) && amount > 0) {
            state.amount = `${amount} CUP`;
            const calculatedPrice = utils.calculateCustomPrice(amount);
            el.customAmountPrice.textContent = calculatedPrice;
            el.customAmountResult.style.display = 'block';
          } else {
            state.amount = null;
            el.customAmountResult.style.display = 'none';
          }
          
          el.provSec.style.display = state.amount ? 'block' : 'none';
          utils.updateStep(state.amount ? 3 : 2);
          updateUI();
          utils.autoSaveState();
        });

        document.querySelectorAll('.provider-item').forEach(provider => {
          provider.addEventListener('click', () => selectProvider(provider));
          
          provider.addEventListener('keydown', (e) => {
            if ((e.key === 'Enter' || e.key === ' ') && provider.dataset.available === 'true') {
              e.preventDefault();
              selectProvider(provider);
            }
          });
        });

        el.btn.addEventListener('click', () => {
          if (!state.amount || !state.provider) return;
          
          const providerNumber = state.provider.replace(/\D/g, '');
          
          let finalPrice = 0;
          if (state.amount.includes('CUP')) {
            const amountValue = state.amount.split(' ')[0];
            if (basePrices[amountValue]) {
              finalPrice = calculatePriceWithMarkup(basePrices[amountValue]);
            } else {
              finalPrice = utils.calculateCustomPrice(parseInt(amountValue));
            }
          }
          
          const message = `¬°Hola! Me comunico a trav√©s de la plataforma Sojolo Cell.

INFORMACI√ìN DEL CLIENTE:
‚Ä¢ Nombre: ${state.clientName}
‚Ä¢ Tel√©fono: ${state.clientPhone}

SOLICITUD DE TRANSFERENCIA:
‚Ä¢ Monto solicitado: ${state.amount}
‚Ä¢ Precio aproximado: ${finalPrice} CUP
‚Ä¢ Proveedor seleccionado: Proveedor ${state.provider.split(' ')[2]}

Por favor, ind√≠queme:
1. La tasa de cambio aplicable
2. El monto total a pagar en CUP
3. M√©todos de pago disponibles
4. Tiempo estimado para la transferencia

Quedo atento a su respuesta. ¬°Gracias!`;
          
          const url = `https://wa.me/${providerNumber}?text=${encodeURIComponent(message)}`;
          
          window.open(url, '_blank', 'noopener,noreferrer');
          utils.showNotification('Redirigiendo a WhatsApp...', 'success', 'üí¨');
          
          const requestHistory = {
            timestamp: new Date().toISOString(),
            clientName: state.clientName,
            clientPhone: state.clientPhone,
            amount: state.amount,
            price: finalPrice,
            provider: state.provider
          };
          
          try {
            const history = JSON.parse(localStorage.getItem('sojoloCellHistory') || '[]');
            history.unshift(requestHistory);
            if (history.length > 10) history.pop();
            localStorage.setItem('sojoloCellHistory', JSON.stringify(history));
          } catch (e) {
            console.warn('No se pudo guardar el historial:', e);
          }
        });

        const openModal = (modal) => {
          modal.classList.add('active');
          document.body.style.overflow = 'hidden';
        };

        const closeModal = (modal) => {
          modal.classList.remove('active');
          document.body.style.overflow = '';
        };

        el.openPrices.addEventListener('click', () => openModal(el.pricesModal));
        el.openPrivacy.addEventListener('click', () => openModal(el.privacyModal));
        el.closePrices.addEventListener('click', () => closeModal(el.pricesModal));
        el.closePrivacy.addEventListener('click', () => closeModal(el.privacyModal));

        [el.pricesModal, el.privacyModal].forEach((modal) => {
          modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal(modal);
          });
        });

        el.closePromotion.addEventListener('click', utils.hidePromotion);

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            [el.pricesModal, el.privacyModal].forEach(closeModal);
          }
        });

        window.addEventListener('beforeunload', () => {
          utils.stopRecurrentNotifications();
          utils.stopAutoSave();
          utils.autoSaveState();
        });

        document.addEventListener('visibilitychange', () => {
          if (document.hidden) {
            utils.autoSaveState();
          }
        });

        updateUI();
        
        if (state.clientName && state.clientPhone) {
          if (state.amount && state.provider) {
            utils.updateStep(4);
          } else if (state.amount) {
            utils.updateStep(3);
          } else {
            utils.updateStep(2);
          }
        } else {
          utils.updateStep(1);
        }
      };

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>